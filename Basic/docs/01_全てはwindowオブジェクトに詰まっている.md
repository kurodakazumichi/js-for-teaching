# 全てはwindowオブジェクトに詰まっている

JavaScriptは平たく言えば、ブラウザウィンドウそのものを操作する事ができる言語です。

(ブラウザ上で動作する場合)



なのでウィンドウを扱うために必要なデータであったり関数だったりはあらかたそろっている、というわけで

まず第一に、全てはwindowオブジェクトに詰まっているという感覚から身に着けていきたいと思います。



## 実験

Chromeを使っていればウェブサイト上で右クリックして検証ツールが使え、これは非常に便利なのでひとまずこれを使ってみます。



### アラートを表示する

JavaScriptでアラートを表示する場合は、一般的に以下のように書きますが

```
alert();
```

alertはwindowオブジェクトのプロパティなので、次のように書いても問題ありません。

```js
window.alert();
```



JavaScriptではwindowを省略してもいいという暗黙の了解があるのですが、全てはwindowオブジェクトのプロパティという認識をしておくと理解しやすい事も増えてくるので最初にお伝えしました。



### グローバル変数

```js
a = 10;
```

この処理は実際には以下のように書くのと同じことになります

```js
window.a = 10;
```



検証ツールのコンソール上で`a = 10`とした後に、`window.a`と打つとちゃんと10が表示されると思います。



一見すると、ただグローバル変数を定義しただけの処理ですが、JavaScript的には

**windowオブジェクトにaというプロパティを追加する処理**という方が正しい表現かもしれません。



#### コラム

初めてプログラムをする人は何も思わないかもしれませんが、一般的なプログラミング言語において、オブジェクト(つまりはクラスのインスタンス)に後からプロパティ(メンバ変数やメソッド)を追加できるというのは理解し難い感覚だと思いますが、JavaScriptでは普通の事という認識を持っておくといいかもしれません。

JavaScriptのオブジェクトはクラスというよりオブジェクトの連想配列みたいなもの。



**windowオブジェクトという名の連想配列のイメージ**

| キー       | オブジェクト             |
| ---------- | ------------------------ |
| alert      | 関数オブジェクト         |
| innerWidth | 数値オブジェクト         |
| screen     | スクリーンオブジェクト   |
| document   | ドキュメントオブジェクト |
| console    | コンソールオブジェクト   |
| history    | 履歴オブジェクト         |



### グローバル関数

ついでに関数の定義についても触れておきます

```js
function hoge() {
    alert("hoge");
}
```

ただの関数定義にも見えますが、JavaScriptの世界ではwindowオブジェクトに`hoge`というメソッドを追加する処理と言えます。

言葉通りに書くなら以下のようになるかと思います。

```js
window.hoge = () => {
    alert("hoge");
};
```



### `var`と`const`, `let`とか

最近では使ってはいけないといわれる`var`ですが、確かに使う必要ないですが`var`が何なのかは知っておいた方がいいかなーと思っています。

そのうえで最近推奨される`const`や`let`を知る方がいいかと。



#### グローバルスコープ

```js
function test() {
    a = 10;
}
test();
window.a; // 10と表示される
```

`test`という関数を実行する事で、変数`a`が定義されます。



この`a = 10;`という処理は`window.a = 10;`と同じ事なので、`test`を呼び出した瞬間にwindowオブジェクトに`a`というプロパティが追加され、関数呼び出し後であれば`window.a`というプロパティが有効になります。



なかなかびっくりかもしれませんが`a = 10;`を`window.a = 10`と捉えれば当たり前にも見えてきますよね。



またwindowはどこからでもアクセルできるグローバルなオブジェクトであり、`window`は省略可能なので実質グローバル変数になります。



#### 関数スコープ

```js
function test() {
    var a = 10;
}
test();
window.a; // undefinedと表示される
```



変数定義の前に`var`というキーワードを付けるとその変数は関数の中だけで使えるローカル変数になります。(windowオブジェクトのプロパティに追加されない)

なので`test()`を実行したあとに`window.a`としても`undefined`、定義されてないよーという結果になります。

昔のJavaScriptは`var`を付けるか、つけないかしかなかったので基本的に`var`を付けていました。(つけ忘れると偉い事になる)

ただこの`var`、一般的なプロブラム言語と違ってスコープが広く、以下のようにifブロックの中で定義された変数であっても、ifブロックの外で使えてしまいます。

これを関数スコープと呼んでいたりします。

```js
function test() {
    if (true) {
        var a = 10;
    }
	alert(a);
}
```



そんなこんなでJavaScriptには関数スコープかグローバルスコープ(windowオブジェクトに属する)の2パターンしかなく、ゆるゆるだったのですが、それで困ることも多かったので近年では`var`ではなく`let`や`const`が誕生したという経緯があります。



#### ブロックスコープ

```js
function test() {
	if (true) {
		const a = 10;
	}
	alert(a);
}
```

`var`ではなく`const`(または`let`)で定義した場合は一般的なプログラム言語同様、ブロックスコープとなるので、ifブロックの外で変数`a`は使えなくなります。

いわゆるモダンな書き方というやつです。(JavaScripter的にはモダンですが、一般的には普通の事ですね)

そんなわけで、最近のJavaScriptでは代入させたくないなら`const`、代入させたければ`let`を使うと言う感じになっています。